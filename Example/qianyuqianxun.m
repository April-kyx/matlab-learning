%% 准备
clear;clc;
fs=44100;
%《千与千寻》歌曲；
%% 乐音频率
part1=[0 0 0 ...
    0 0 fre(45) fre(47) ...
    fre(49) fre(45) fre(52) fre(49) ...
    fre(47) fre(52) fre(47) ...
    fre(45) fre(42) fre(49) fre(45) ...
    fre(44) fre(44) fre(42) fre(44) fre(45) fre(47)];
part2=[fre(40) fre(45) fre(47) fre(49) ...
    fre(50) fre(50) fre(49) fre(47) fre(45) ...
    fre(47) fre(45) fre(47) ...
    fre(49) fre(45) fre(52) fre(49) ...
    fre(47) fre(52) fre(47) ...
    fre(45) fre(42) fre(42) fre(44) fre(45) ...
    fre(40) 0 fre(40)];
part3=[fre(42) fre(44) fre(45) fre(47) ...
    fre(40) fre(45) fre(47) fre(49) ...
    fre(50) fre(50) fre(49) fre(47) fre(45) ...
    fre(45) ...
    0 0 fre(49) fre(50) ...
    fre(52) fre(52) fre(52) ...
    fre(52) fre(52) fre(54) fre(52) fre(50)];
part4=[fre(49) fre(49) fre(49) ...
    fre(49) fre(49) fre(50) fre(49) fre(47) ...
    fre(45) fre(45) fre(45) fre(44) ...
    fre(42) fre(44) fre(44) fre(45) ...
    fre(47) fre(47) fre(49) fre(47) fre(49) ...
    fre(47) fre(49) fre(50) ...
    fre(52) fre(52) fre(52)];
part5=[fre(52) fre(52) fre(54) fre(52) fre(50) ...
    fre(49) fre(49) fre(49) ...
    fre(49) fre(50) fre(49) fre(47) fre(45) fre(44) ...
    fre(42) fre(42) fre(44) fre(45) fre(47) ...
    fre(40) fre(45) fre(47) fre(49) ...
    fre(47) fre(47) fre(47) fre(45) ...
    fre(45)];
part6=[0 0 0 ...
    0 0 fre(45) fre(47) ...
    fre(49) fre(45) fre(52) fre(49) ...
    fre(47) fre(52) fre(47) ...
    fre(45) fre(42) fre(49) fre(45) ...
    fre(44) fre(44) fre(42) fre(44) fre(45) fre(47)];
part7=[fre(40) fre(45) fre(47) fre(49) ...
    fre(50) fre(50) fre(49) fre(47) fre(45) ...
    fre(47) fre(45) fre(47) ...
    fre(49) fre(45) fre(52) fre(49) ...
    fre(47) fre(52) fre(47) ...
    fre(45) fre(42) fre(42) fre(44) fre(45) ...
    fre(40) 0 fre(40)];
part8=[fre(42) fre(44) fre(45) fre(47) ...
    fre(40) fre(45) fre(44) ...
    fre(42) fre(44) fre(45) fre(47) ...
    fre(40) fre(45) fre(44) ...
    fre(42) fre(44) fre(45) fre(47) ...
    fre(40) fre(45) fre(47) fre(49) ...
    fre(50) fre(50) fre(49) fre(47) fre(45)];
part9=[fre(45) ...
    0 0 fre(49) fre(50) ...
    fre(52) fre(52) fre(52) ...
    fre(52) fre(52) fre(54) fre(52) fre(50) ...
    fre(49) fre(49) fre(49)];
part10=[fre(49) fre(49) fre(50) fre(49) fre(47) ...
    fre(45) fre(45) fre(45) fre(44) ...
    fre(42) fre(44) fre(44) fre(45) ...
    fre(47) fre(47) fre(49) fre(47) fre(49) ...
    fre(47) fre(49) fre(50) ...
    fre(52) fre(52) fre(52) ...
    fre(52) fre(52) fre(54) fre(52) fre(50)];
part11=[fre(49) fre(49) fre(49) ...
    fre(49) fre(50) fre(49) fre(47) fre(45) fre(44) ...
    fre(42) fre(42) fre(44) fre(45) fre(47) ...
    fre(40) fre(45) fre(47) fre(49) ...
    fre(47) fre(47) fre(47) fre(45) ...
    fre(45) ...
    0 0 0];

para=[part1 part2 part3 part4 part5 part6 part7 part8 part9 part10 part11];
fr=para;
%% 每个乐音的时间
part1time=[0.5 0.5 0.5 ...
    0.5 0.5 0.25 0.25 ...
    0.25 0.25 0.75 0.25 ...
    0.5 0.5 0.5 ...
    0.25 0.25 0.75 0.25 ...
    1 0.5 ...
    0.5 0.5 0.25 0.25];
part2time=[0.5 0.5 0.25 0.25 ...
    0.5 0.25 0.25 0.25 0.25 ...
    1 0.25 0.25 ...
    0.25 0.25 0.75 0.25 ...
    0.5 0.5 0.5 ...
    0.25 0.25 0.5 0.25 0.25 ...
    1 0.25 0.25];
part3time=[0.5 0.5 0.25 0.25 ...
    0.5 0.5 0.25 0.25 ...
    0.5 0.25 0.25 0.25 0.25 ...
    1.5 ...
    0.5 0.5 0.25 0.25 ...
    0.5 0.5 0.5 ...
    0.5 0.25 0.25 0.25 0.25];
part4time=[0.5 0.5 0.5 ...
    0.5 0.25 0.25 0.25 0.25 ...
    0.5 0.5 0.25 0.25 ...
    0.5 0.5 0.25 0.25 ...
    0.5 0.25 0.25 0.25 0.25 ...
    1 0.25 0.25 ...
    0.5 0.5 0.5];
part5time=[0.5 0.25 0.25 0.25 0.25 ...
    0.5 0.5 0.5 ...
    0.25 0.25 0.25 0.25 0.25 0.25 ...
    0.5 0.25 0.25 0.25 0.25 ...
    0.5 0.5 0.25 0.25 ...
    0.75 0.25 0.25 0.25 ...
    1.5];
part6time=[0.5 0.5 0.5 ...
    0.5 0.5 0.25 0.25 ...
    0.25 0.25 0.75 0.25 ...
    0.5 0.5 0.5 ...
    0.25 0.25 0.75 0.25 ...
    1 0.5 ...
    0.5 0.5 0.25 0.25];
part7time=[0.5 0.5 0.25 0.25 ...
    0.5 0.25 0.25 0.25 0.25 ...
    1 0.25 0.25 ...
    0.25 0.25 0.75 0.25 ...
    0.5 0.5 0.5 ...
    0.25 0.25 0.5 0.25 0.25 ...
    1 0.25 0.25];
part8time=[0.5 0.5 0.25 0.25 ...
    0.5 0.75 0.25 ...
    0.5 0.5 0.25 0.25 ...
    0.75 0.25 0.25 ...
    0.5 0.5 0.25 0.25 ...
    0.5 0.5 0.25 0.25 ...
    0.5 0.25 0.25 0.25 0.25];
part9time=[4.5 ...
    0.5 0.5 0.25 0.25 ...
    0.5 0.5 0.5 ...
    0.5 0.25 0.25 0.25 0.25 ...
    0.5 0.5 0.5];
part10time=[0.5 0.25 0.25 0.25 0.25 ...
    0.5 0.5 0.25 0.25 ...
    0.5 0.5 0.25 0.25 ...
    0.5 0.25 0.25 0.25 0.25 ...
    1 0.25 0.25 ...
    0.5 0.5 0.5 ...
    0.5 0.25 0.25 0.25 0.25];
part11time=[0.5 0.5 0.5 ...
    0.25 0.25 0.25 0.25 0.25 0.25 ...
    0.5 0.25 0.25 0.25 0.25 ...
    0.5 0.5 0.25 0.25 ...
    0.75 0.25 0.25 0.5 ...
    4.5 ...
    0.5 0.5 0.5];

paratime=[part1time part2time part3time part4time part5time part6time part7time ...
    part8time part9time part10time part11time];
%% 去噪，加谐波
time=fs*paratime;
N=length(time);
east=zeros(1,N);
n=1;
for num=1:N  
   t=1/fs:1/fs:time(num)/fs;
   baoluo=zeros(1,time(num));
   for j=1:time(num)
       if(j<0.2*time(num))
           y=7.5*j/time(num);
       else
           if(j<0.333*time(num))
               y=-15/4*j/time(num)+9/4;
           else
               if(j<0.666*time(num))
                   y=1;
               else
                   y=-3*j/time(num)+3;
               end
           end
       end
       baoluo(j)=y;
   end
 h=[1 0.2 0.3 0.1];
 xiebo=zeros(1,length(t));
   for i=1:length(h)
       s=sin(2*i*pi*fr(num)*t);
       xiebo=xiebo+h(i)*s;
   end
   east(n:n+time(num)-1)=xiebo.*baoluo(1:time(num)); %注意乐音频率和时间的矩阵维数相等；
   n=n+time(num);
end
%% 播放
sound(east,fs);%有点像喇叭
% plot(east);
% y=east;
% audiowrite('千与千寻.wav',y,fs); %保存；
%% 引用函数
function f=fre(p)
f=440*2^((p-49)/12);
end