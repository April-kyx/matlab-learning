%% 准备
clear;clc;
fs=44100;
%《千与千寻》歌曲；
%这个乐谱中的第二行是伴奏，第一行是主乐；
%% 乐音频率
part1=[0 0 0 ...
    0 0 fre(45) fre(47) ...
    fre(49) fre(45) fre(52) fre(49) ...
    fre(47) fre(52) fre(47) ...
    fre(45) fre(42) fre(49) fre(45) ...
    fre(44) fre(44) fre(42) fre(44) fre(45) fre(47)];
part2=[fre(40) fre(45) fre(47) fre(49) ...
    fre(50) fre(50) fre(49) fre(47) fre(45) ...
    fre(47) fre(45) fre(47) ...
    fre(49) fre(45) fre(52) fre(49) ...
    fre(47) fre(52) fre(47) ...
    fre(45) fre(42) fre(42) fre(44) fre(45) ...
    fre(40) 0 fre(40)];
part3=[fre(42) fre(44) fre(45) fre(47) ...
    fre(40) fre(45) fre(47) fre(49) ...
    fre(50) fre(50) fre(49) fre(47) fre(45) ...
    fre(45) ...
    0 0 fre(49) fre(50) ...
    fre(52) fre(52) fre(52) ...
    fre(52) fre(52) fre(54) fre(52) fre(50)];
part4=[fre(49) fre(49) fre(49) ...
    fre(49) fre(49) fre(50) fre(49) fre(47) ...
    fre(45) fre(45) fre(45) fre(44) ...
    fre(42) fre(44) fre(44) fre(45) ...
    fre(47) fre(47) fre(49) fre(47) fre(49) ...
    fre(47) fre(49) fre(50) ...
    fre(52) fre(52) fre(52)];
part5=[fre(52) fre(52) fre(54) fre(52) fre(50) ...
    fre(49) fre(49) fre(49) ...
    fre(49) fre(50) fre(49) fre(47) fre(45) fre(44) ...
    fre(42) fre(42) fre(44) fre(45) fre(47) ...
    fre(40) fre(45) fre(47) fre(49) ...
    fre(47) fre(47) fre(47) fre(45) ...
    fre(45)];
part6=[0 0 0 ...
    0 0 0 ...
    fre(40) fre(45) ...
    fre(44) fre(40) ...
    fre(42) fre(42) ...
    fre(44) fre(45) fre(44) fre(40) fre(44) fre(37) ...
    fre(38) fre(38)];
part7=[fre(37) ...
    fre(35) fre(35) ...
    fre(40) 0 ...
    fre(40) fre(45) ...
    fre(44) fre(40) ...
    fre(42) fre(42) ...
    fre(37) fre(37) fre(38) fre(37) fre(35) fre(37)];
part8=[fre(33) ...
    fre(33) ...
    fre(35) ...
    fre(37) ...
    0 0 0 ...
    fre(45) fre(45) fre(45) ...
    fre(47) fre(45) fre(44)];
part9=[fre(42) fre(42) fre(42) fre(45) ...
    fre(40) fre(40) fre(37) ...
    fre(42) fre(42) fre(42) fre(37) ...
    fre(38) fre(38) ...
    fre(42) fre(40) fre(42) fre(40) fre(42) ...
    fre(40) 0 ...
    fre(45) fre(45) fre(45)];
part10=[fre(47) fre(45) fre(44) ...
    fre(42) fre(42) fre(42) fre(45) ...
    fre(40) fre(40) fre(37) ...
    fre(33) fre(33) fre(38) ...
    fre(37) fre(37) ...
    fre(35) fre(40) fre(40) ...
    fre(37)];

para1=[part1 part2 part3 part4 part5];
para2=[part6 part7 part8 part9 part10];
if(length(para1)>=length(para2))
    fr=zeros(2,length(para1));
    fr(1,1:length(para1))=para1;
    fr(2,1:length(para2))=para2;
else
    fr=zeros(2,length(para2));
    fr(1,1:length(para1))=para1;
    fr(2,1:length(para2))=para2;
end
%% 每个乐音的时间
part1time=[0.5 0.5 0.5 ...
    0.5 0.5 0.25 0.25 ...
    0.25 0.25 0.75 0.25 ...
    0.5 0.5 0.5 ...
    0.25 0.25 0.75 0.25 ...
    1 0.5 ...
    0.5 0.5 0.25 0.25];
part2time=[0.5 0.5 0.25 0.25 ...
    0.5 0.25 0.25 0.25 0.25 ...
    1 0.25 0.25 ...
    0.25 0.25 0.75 0.25 ...
    0.5 0.5 0.5 ...
    0.25 0.25 0.5 0.25 0.25 ...
    1 0.25 0.25];
part3time=[0.5 0.5 0.25 0.25 ...
    0.5 0.5 0.25 0.25 ...
    0.5 0.25 0.25 0.25 0.25 ...
    1.5 ...
    0.5 0.5 0.25 0.25 ...
    0.5 0.5 0.5 ...
    0.5 0.25 0.25 0.25 0.25];
part4time=[0.5 0.5 0.5 ...
    0.5 0.25 0.25 0.25 0.25 ...
    0.5 0.5 0.25 0.25 ...
    0.5 0.5 0.25 0.25 ...
    0.5 0.25 0.25 0.25 0.25 ...
    1 0.25 0.25 ...
    0.5 0.5 0.5];
part5time=[0.5 0.25 0.25 0.25 0.25 ...
    0.5 0.5 0.5 ...
    0.25 0.25 0.25 0.25 0.25 0.25 ...
    0.5 0.25 0.25 0.25 0.25 ...
    0.5 0.5 0.25 0.25 ...
    0.75 0.25 0.25 0.25 ...
    1.5];
part6time=[0.5 0.5 0.5 ...
    0.5 0.5 0.5 ...
    1 0.5 ...
    1 0.5 ...
    1 0.5 ...
    0.25 0.25 0.25 0.25 0.25 0.25 ...
    1 0.5];
part7time=[1.5 ...
    1 0.5 ...
    1 0.5 ...
    1 0.5 ...
    1 0.5 ...
    1 0.5 ...
    0.25 0.25 0.25 0.25 0.25 0.25];
part8time=[1.5 ...
    1.5 ...
    1.5 ...
    1.5 ...
    0.5 0.5 0.5 ...
    0.5 0.5 0.5 ...
    0.75 0.25 0.5];
part9time=[0.5 0.5 0.25 0.25 ...
    1 0.25 0.25 ...
    0.5 0.5 0.25 0.25 ...
    1 0.5 ...
    0.5 0.25 0.25 0.25 0.25 ...
    1 0.5 ...
    0.5 0.5 0.5];
part10time=[0.75 0.25 0.5 ...
    0.5 0.5 0.25 0.25 ...
    1 0.25 0.25 ...
    0.5 0.5 0.5 ...
    1 0.5 ...
    0.75 0.25 0.5 ...
    1.5];

paratime1=[part1time part2time part3time part4time part5time];
paratime2=[part6time part7time part8time part9time part10time];
if(length(paratime1)>=length(paratime2))
    paratime=zeros(2,length(paratime1));
    paratime(1,1:length(paratime1))=paratime1;
    paratime(2,1:length(paratime2))=paratime2;
else
    paratime=zeros(2,length(paratime2));
    paratime(1,1:length(paratime1))=paratime1;
    paratime(2,1:length(paratime2))=paratime2;
end
%% 去噪，加谐波
time=fs*paratime;
N=length(time);
east=zeros(2,N);
n=1;
for num=1:N  
   t=1/fs:1/fs:time(1,num)/fs;
   baoluo=zeros(1,time(1,num));
   for j=1:time(1,num)
       if(j<0.2*time(1,num))
           y=7.5*j/time(1,num);
       else
           if(j<0.333*time(1,num))
               y=-15/4*j/time(1,num)+9/4;
           else
               if(j<0.666*time(1,num))
                   y=1;
               else
                   y=-3*j/time(1,num)+3;
               end
           end
       end
       baoluo(j)=y;
    end
 h=[1 0.2 0.3 0.1];
 xiebo=zeros(1,length(t));
 for i=1:length(h)
    xiebo=xiebo+h(i)*sin(2*i*pi*fr(1,num)*t);
 end
 east(1,n:n+time(1,num)-1)=xiebo.*baoluo(1:time(1,num));
 n=n+time(1,num);
end
k=1;
for num=1:N  
   t=1/fs:1/fs:time(2,num)/fs;
   baoluo=zeros(1,time(2,num));
   for j=1:time(2,num)
       if(j<0.2*time(2,num))
           y=7.5*j/time(2,num);
       else
           if(j<0.333*time(2,num))
               y=-15/4*j/time(2,num)+9/4;
           else
               if(j<0.666*time(2,num))
                   y=1;
               else
                   y=-3*j/time(2,num)+3;
               end
           end
       end
       baoluo(j)=y;
    end
 h=[0.6 0.4 0.5 0.2];
 xiebo=zeros(1,length(t));
 for i=1:length(h)
     xiebo=xiebo+h(i)*sin(2*i*pi*fr(2,num)*t);
 end
 east(2,k:k+time(2,num)-1)=xiebo.*baoluo(1:time(2,num));
 k=k+time(2,num);
end
%% 播放
sound(east,fs);%有点像喇叭
%% 引用函数
function f=fre(p)
f=440*2^((p-49)/12);
end